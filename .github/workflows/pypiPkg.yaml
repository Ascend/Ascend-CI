name: Build and publish to PyPI

on:
  workflow_dispatch:
  schedule:
    - cron: '6 * * * *'

jobs:
  build-x86:
    name: Build for x86_64
    runs-on: ONNXRuntime
    steps:
      - name: Clone ASCEND-CI project
        uses: actions/checkout@v4
        with:
          repository: Ascend/Ascend-CI
          path: Ascend-CI

      - name: Build and upload pypi
        env:
          PYPI_TOKEN: ${{ secrets.PYPI_TOKEN }}
        working-directory: Ascend-CI
        run: |
          docker build \
            --build-arg ARCH=x86_64 \
            --build-arg PYTHON_VERSION=310 \
            -t pypi:latest \
            -f docker/Dockerfile .

          docker run --rm \
            -v ${{ github.workspace }}/Ascend-CI:/root/Ascend-CI \
            -v /home/last_tag.txt:/root/last_tag.txt \
            -e PYPI_TOKEN \
            pypi:latest \
            bash -c "chmod +x /root/Ascend-CI/script/pypiPkg.sh && /root/Ascend-CI/script/pypiPkg.sh"
          

  # build-arm:
  #   name: Build for aarch64
  #   runs-on: runner-arm
  #   steps:
  #     - uses: actions/checkout@v4

  #     - name: Write .pypirc file
  #       run: echo "${{ secrets.PYPI_TOKEN }}" > ~/.pypirc

  #     - name: Build and publish (aarch)
  #       run: |
          
